#!/usr/bin/env zsh

rename_function() {
    local function_name="$1"
    local new_function_name="$2"

    # cmfh = command_not_found_handler
    local initial_function="$(which "$function_name")"

    if [[ $? -eq 0 ]]; then
        local function_lines="$(echo "$initial_function" | wc -l)"

        local new_function="$(echo -n "${new_function_name}() \{"; cat "$initial_function" | tail -n $((function_lines - 1)))"

        eval "$new_function"
    else
        return 1
    fi
}

xenv() {
    export XENV_EXPORT_SCRIPT="$HOME/xenv_script"

    local initial_pythonpath="$PYTHONPATH"
    export PYTHONPATH="$PYTHONPATH:$XENV_HOME/python"

    python -m xenv "$@"

    export PYTHONPATH="$initial_pythonpath"

    local retcode=$?

    if [[ -f "$XENV_EXPORT_SCRIPT" ]]
    then
        source "$XENV_EXPORT_SCRIPT"
        rm "$XENV_EXPORT_SCRIPT"
 
        # echo "$XENV_EXPORT_SCRIPT"
        # cat "$XENV_EXPORT_SCRIPT"
    fi

    unset XENV_EXPORT_SCRIPT

    return $retcode
}

export XENV_HOME="${XDG_CONFIG_HOME:-$HOME/.config}/xenv"

