xenv() {
    source_files_dir="$(mktemp -d)"

    python "$_xenv_python_entry" --source-files-dir "$source_files_dir" "$@"

    retcode=$?

    for file in $(find "$source_files_dir" -maxdepth 1 -type f); do
       source "$file"
    done

    # rm -rf "$source_files_dir" 2> /dev/null

    [[ "$1" == "deactivate" ]] && { echo "xenv unloaded"; unset -f xenv; return 0 }

    return $retcode
}

export _xenv_python_entry="$HOME/config/bin/xenv.py"

echo "xenv loaded"
